***HTTP方法的安全性与幂等性***

[TOC]

# 1. 安全性

安全方法是指不修改资源的 HTTP 方法。

譬如，当使用 GET 或者 HEAD 作为资源URL，都必须不去改变资源。然而，这并不全准确。意思是：它不改变资源的表示形式。对于安全方法，它仍然可能改变服务器上的内容或资源，但这必须不导致不同的表现形式。

# 2. 幂等性

HTTP 幂等方法是指无论调用多少次都不会有不同结果的HTTP方法。它无论是调用一次，还是十次都无关紧要。结果仍应相同。再次强调， 它只作用于结果而非资源本身。它仍可能被操纵（如一个更新的timestamp），提供这一信息并不影响（当前）资源的表现形式。

# 3. HTTP方法概览

HTTP Method | Idempotent | Safe
---|---|---
OPTIONS | yes | yes
GET | yes | yes
HEAD | yes | yes 
PUT | yes | no
POST | no | no
DELETE | yes | no
PATCH | no | no

可以认为安全的方法都是只读的方法(GET, HEAD, OPTIONS)，不会改变资源状态，显然，这三个方法也是幂等的。

DELETE方法的语义表示删除服务器上的一个资源，第一次删除成功后该资源就不存在了，资源状态改变了，所以DELETE方法不具备安全特性。

然而HTTP协议规定DELETE方法是幂等的，每次删除该资源都要返回状态码200 OK，服务器端要实现幂等的DELETE方法，必须记录所有已删除资源的元数据(Metadata),否则，第二次删除后返回的响应码就会类似404 Not Found了。

PUT和POST方法语义中都有修改资源状态的意思，因此都不是安全的。但是PUT方法是幂等的，POST方法不是幂等的，这么设计的理由是：HTTP协议规定，POST方法修改资源状态时，URL指示的是该资源的父级资源，待修改资源的ID信息在请求体中携带。而PUT方法修改资源状态时，URL直接指示待修改资源。因此，同样是创建资源，重复提交POST请求可能产生两个不同的资源，而重复提交PUT请求只会对其URL中指定的资源起作用，也就是只会创建一个资源。

