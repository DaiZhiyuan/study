
## benchmark memory rate

```
[root@centos7 ~]# ./stream
-------------------------------------------------------------
STREAM version $Revision: 5.10 $
-------------------------------------------------------------
This system uses 8 bytes per array element.
-------------------------------------------------------------
Array size = 80000000 (elements), Offset = 0 (elements)
Memory per array = 610.4 MiB (= 0.6 GiB).
Total memory required = 1831.1 MiB (= 1.8 GiB).
Each kernel will be executed 20 times.
 The *best* time for each kernel (excluding the first iteration)
 will be used to compute the reported bandwidth.
-------------------------------------------------------------
Number of Threads requested = 64
Number of Threads counted = 64
-------------------------------------------------------------
Your clock granularity/precision appears to be 1 microseconds.
Each test below will take on the order of 25597 microseconds.
   (= 25597 clock ticks)
Increase the size of the arrays if this shows that
you are not getting at least 20 clock ticks per test.
-------------------------------------------------------------
WARNING -- The above is only a rough guideline.
For best results, please be sure you know the
precision of your system timer.
-------------------------------------------------------------
Function    Best Rate MB/s  Avg time     Min time     Max time
Copy:           86392.8     0.015816     0.014816     0.018295
Scale:          95152.8     0.014183     0.013452     0.019348
Add:            98562.7     0.021850     0.019480     0.032150
Triad:         100026.9     0.020286     0.019195     0.021396
-------------------------------------------------------------
Solution Validates: avg error less than 1.000000e-13 on all three arrays
-------------------------------------------------------------
```

## benchmark local access
```bash 
#!/bin/bash

echo "------------------------------------------------------------------------------"
echo "Node    Core    Function    Best Rate MB/s  Avg time     Min time     Max time"
node=0
for core in `seq 0 63`; do
        echo 3 > /proc/sys/vm/drop_caches
        if [ `expr $core % 8` == 0 ];then
                let node++
        fi
        if [ `expr $core % 4` == 0 ];then
                echo "------------------------------------------------------------------------------"
        fi
        echo -n "$((node-1))       $core       "
        numactl --membind=$((node-1)) taskset -c $core ./stream | egrep Triad
done
echo "------------------------------------------------------------------------------"
```

report:
```
[root@centos7 ~]# ./benchmark_numa_local.sh
------------------------------------------------------------------------------
Node    Core    Function    Best Rate MB/s  Avg time     Min time     Max time
------------------------------------------------------------------------------
0       0       Triad:           8728.7     0.220103     0.219965     0.220473
0       1       Triad:           8683.5     0.221181     0.221108     0.221458
0       2       Triad:           8795.7     0.218370     0.218288     0.218569
0       3       Triad:           8839.7     0.217268     0.217203     0.217482
------------------------------------------------------------------------------
0       4       Triad:           9203.1     0.208744     0.208626     0.210073
0       5       Triad:           9109.2     0.210845     0.210777     0.210891
0       6       Triad:           9160.9     0.209640     0.209587     0.209748
0       7       Triad:           9109.1     0.210822     0.210779     0.210957
------------------------------------------------------------------------------
1       8       Triad:           8702.0     0.220675     0.220640     0.220717
1       9       Triad:           8633.6     0.222457     0.222388     0.222568
1       10       Triad:           8660.7     0.221794     0.221692     0.221881
1       11       Triad:           8664.8     0.221638     0.221587     0.221706
------------------------------------------------------------------------------
1       12       Triad:           9068.9     0.211752     0.211713     0.211826
1       13       Triad:           8980.8     0.213823     0.213789     0.213858
1       14       Triad:           8979.6     0.213857     0.213817     0.213922
1       15       Triad:           8979.5     0.213852     0.213821     0.213889
------------------------------------------------------------------------------
2       16       Triad:           8974.7     0.213965     0.213934     0.214001
2       17       Triad:           8933.5     0.214956     0.214922     0.215001
2       18       Triad:           8933.3     0.214957     0.214926     0.214996
2       19       Triad:           8933.4     0.214966     0.214924     0.215024
------------------------------------------------------------------------------
2       20       Triad:           9361.4     0.205117     0.205097     0.205142
2       21       Triad:           9269.7     0.207166     0.207126     0.207202
2       22       Triad:           9269.0     0.207168     0.207143     0.207227
2       23       Triad:           9268.1     0.207191     0.207162     0.207213
------------------------------------------------------------------------------
3       24       Triad:           8426.8     0.227873     0.227844     0.227934
3       25       Triad:           8381.5     0.229102     0.229076     0.229135
3       26       Triad:           8382.6     0.229085     0.229045     0.229135
3       27       Triad:           8382.5     0.229108     0.229049     0.229385
------------------------------------------------------------------------------
3       28       Triad:           8770.3     0.218958     0.218922     0.219006
3       29       Triad:           8666.8     0.221563     0.221536     0.221587
3       30       Triad:           8667.0     0.221575     0.221529     0.221728
3       31       Triad:           8666.5     0.221582     0.221542     0.221645
------------------------------------------------------------------------------
4       32       Triad:           8979.2     0.213875     0.213827     0.213913
4       33       Triad:           8931.1     0.215015     0.214978     0.215067
4       34       Triad:           8934.6     0.214928     0.214895     0.215011
4       35       Triad:           8931.4     0.215013     0.214973     0.215100
------------------------------------------------------------------------------
4       36       Triad:           9362.5     0.205112     0.205073     0.205160
4       37       Triad:           9269.4     0.207166     0.207134     0.207198
4       38       Triad:           9269.3     0.207156     0.207135     0.207194
4       39       Triad:           9268.5     0.207201     0.207153     0.207586
------------------------------------------------------------------------------
5       40       Triad:           8427.3     0.227880     0.227832     0.228033
5       41       Triad:           8382.7     0.229085     0.229043     0.229124
5       42       Triad:           8382.8     0.229080     0.229041     0.229129
5       43       Triad:           8383.2     0.229059     0.229030     0.229093
------------------------------------------------------------------------------
5       44       Triad:           8770.3     0.218992     0.218921     0.219723
5       45       Triad:           8665.9     0.221614     0.221558     0.222118
5       46       Triad:           8666.3     0.221586     0.221548     0.221625
5       47       Triad:           8666.3     0.221595     0.221549     0.221664
------------------------------------------------------------------------------
6       48       Triad:           8973.5     0.214038     0.213964     0.214915
6       49       Triad:           8932.4     0.214993     0.214948     0.215036
6       50       Triad:           8932.9     0.214996     0.214937     0.215540
6       51       Triad:           8933.7     0.214948     0.214916     0.215001
------------------------------------------------------------------------------
6       52       Triad:           9361.1     0.205142     0.205105     0.205213
6       53       Triad:           9268.6     0.207199     0.207152     0.207225
6       54       Triad:           9269.9     0.207177     0.207123     0.207212
6       55       Triad:           9268.0     0.207193     0.207164     0.207257
------------------------------------------------------------------------------
7       56       Triad:           8699.0     0.220746     0.220716     0.220797
7       57       Triad:           8666.6     0.221577     0.221539     0.221622
7       58       Triad:           8666.0     0.221599     0.221555     0.221686
7       59       Triad:           8666.7     0.221572     0.221537     0.221651
------------------------------------------------------------------------------
7       60       Triad:           9068.2     0.211755     0.211728     0.211789
7       61       Triad:           8979.1     0.213869     0.213830     0.213908
7       62       Triad:           8980.2     0.213835     0.213803     0.213858
7       63       Triad:           8979.7     0.213854     0.213815     0.213909
------------------------------------------------------------------------------
```

## benchmark remote accress

benchmark_numa_remote.sh
```bash
[root@centos7 opt]# cat benchmark_numa_remote.sh
#!/bin/bash

echo "------------------------------------------------------------------------------"
echo "Node    Core    Function    Best Rate MB/s  Avg time     Min time     Max time"
node=0
for core in `seq 0 63`; do
        echo 3 > /proc/sys/vm/drop_caches
        if [ `expr $core % 4` == 0 ];then
                echo "------------------------------------------------------------------------------"
                for node in `seq 0 7`; do
                        echo -n "$node       $core       "
                        numactl --membind=$node taskset -c $core ./stream | egrep Triad
                done
        fi
done
echo "------------------------------------------------------------------------------"
```

report:
```
[root@centos7 ~]# ./benchmark_numa_remote.sh
------------------------------------------------------------------------------
Node    Core    Function    Best Rate MB/s  Avg time     Min time     Max time
------------------------------------------------------------------------------
0       0       Triad:           8767.9     0.219122     0.218981     0.219396
1       0       Triad:           7588.9     0.253106     0.253002     0.253536
2       0       Triad:           6062.7     0.316770     0.316690     0.316949
3       0       Triad:           6471.8     0.296887     0.296673     0.297158
4       0       Triad:           7085.0     0.271120     0.270996     0.271514
5       0       Triad:           6006.3     0.319798     0.319667     0.320164
6       0       Triad:           5080.1     0.378077     0.377942     0.378452
7       0       Triad:           5559.0     0.345483     0.345385     0.345702
------------------------------------------------------------------------------
0       4       Triad:           9080.8     0.211482     0.211436     0.211548
1       4       Triad:           7586.7     0.253175     0.253074     0.254064
2       4       Triad:           6063.8     0.316661     0.316635     0.316688
3       4       Triad:           6472.8     0.296738     0.296626     0.297859
4       4       Triad:           7086.0     0.270976     0.270956     0.270991
5       4       Triad:           6006.9     0.319709     0.319632     0.320437
6       4       Triad:           5081.5     0.377884     0.377843     0.378033
7       4       Triad:           5560.3     0.345342     0.345306     0.345374
------------------------------------------------------------------------------
0       8       Triad:           7581.6     0.253295     0.253244     0.253357
1       8       Triad:           8698.8     0.220758     0.220720     0.220823
2       8       Triad:           6786.2     0.282949     0.282928     0.282985
3       8       Triad:           7325.1     0.262167     0.262112     0.262430
4       8       Triad:           6285.4     0.305533     0.305471     0.305780
5       8       Triad:           6715.8     0.285926     0.285894     0.285982
6       8       Triad:           5626.6     0.341275     0.341234     0.341402
7       8       Triad:           6198.8     0.309827     0.309735     0.309926
------------------------------------------------------------------------------
0       12       Triad:           7582.9     0.253275     0.253201     0.253383
1       12       Triad:           9069.0     0.211744     0.211711     0.211810
2       12       Triad:           6788.2     0.282866     0.282842     0.282892
3       12       Triad:           7333.8     0.261848     0.261803     0.261895
4       12       Triad:           6285.8     0.305471     0.305450     0.305495
5       12       Triad:           6716.2     0.285905     0.285878     0.285953
6       12       Triad:           5627.1     0.341235     0.341204     0.341268
7       12       Triad:           6196.5     0.309895     0.309854     0.309989
------------------------------------------------------------------------------
0       16       Triad:           5936.2     0.323495     0.323441     0.323613
1       16       Triad:           6844.8     0.280539     0.280503     0.280582
2       16       Triad:           8973.3     0.213990     0.213969     0.214039
3       16       Triad:           7287.6     0.263495     0.263462     0.263548
4       16       Triad:           5063.0     0.379249     0.379224     0.379301
5       16       Triad:           5383.0     0.356712     0.356680     0.356744
6       16       Triad:           7085.0     0.271038     0.270995     0.271082
7       16       Triad:           6180.2     0.311142     0.310671     0.311401
------------------------------------------------------------------------------
0       20       Triad:           5913.6     0.324732     0.324678     0.324800
1       20       Triad:           6708.2     0.286247     0.286219     0.286304
2       20       Triad:           9361.8     0.205124     0.205088     0.205174
3       20       Triad:           7285.6     0.263551     0.263535     0.263580
4       20       Triad:           5062.5     0.379312     0.379260     0.379413
5       20       Triad:           5383.4     0.356674     0.356652     0.356700
6       20       Triad:           7085.4     0.271007     0.270979     0.271067
7       20       Triad:           6204.3     0.309492     0.309463     0.309533
------------------------------------------------------------------------------
0       24       Triad:           6655.8     0.288516     0.288470     0.288577
1       24       Triad:           7611.7     0.252289     0.252244     0.252419
2       24       Triad:           7715.1     0.248892     0.248864     0.248923
3       24       Triad:           8426.2     0.227909     0.227860     0.227953
4       24       Triad:           5627.6     0.341211     0.341176     0.341258
5       24       Triad:           6007.9     0.319675     0.319581     0.319722
6       24       Triad:           6282.8     0.305667     0.305595     0.305794
7       24       Triad:           6944.6     0.276527     0.276474     0.277084
------------------------------------------------------------------------------
0       28       Triad:           6653.6     0.288833     0.288565     0.288978
1       28       Triad:           7603.0     0.252609     0.252532     0.252753
2       28       Triad:           7715.0     0.248910     0.248865     0.249164
3       28       Triad:           8770.4     0.218961     0.218919     0.219066
4       28       Triad:           5627.0     0.341237     0.341209     0.341276
5       28       Triad:           6007.0     0.319658     0.319625     0.319700
6       28       Triad:           6283.0     0.305621     0.305587     0.305654
7       28       Triad:           6943.9     0.276526     0.276502     0.276561
------------------------------------------------------------------------------
0       32       Triad:           6927.7     0.277198     0.277150     0.277319
1       32       Triad:           6253.5     0.307177     0.307028     0.307289
2       32       Triad:           5062.1     0.379314     0.379286     0.379350
3       32       Triad:           5384.3     0.356636     0.356594     0.356674
4       32       Triad:           8975.2     0.213949     0.213922     0.213980
5       32       Triad:           7288.3     0.263455     0.263436     0.263508
6       32       Triad:           6035.6     0.318156     0.318110     0.318224
7       32       Triad:           6657.1     0.288443     0.288412     0.288484
------------------------------------------------------------------------------
0       36       Triad:           6912.0     0.277814     0.277779     0.277881
1       36       Triad:           6254.0     0.307063     0.307005     0.307123
2       36       Triad:           5062.0     0.379332     0.379298     0.379455
3       36       Triad:           5383.3     0.356690     0.356659     0.356727
4       36       Triad:           9362.6     0.205106     0.205071     0.205138
5       36       Triad:           7287.1     0.263526     0.263479     0.263566
6       36       Triad:           6035.9     0.318173     0.318098     0.318629
7       36       Triad:           6656.8     0.288481     0.288429     0.288725
------------------------------------------------------------------------------
0       40       Triad:           6203.7     0.310810     0.309493     0.311281
1       40       Triad:           7046.6     0.273693     0.272473     0.274393
2       40       Triad:           5627.0     0.341278     0.341212     0.341428
3       40       Triad:           6009.7     0.319583     0.319482     0.320221
4       40       Triad:           7715.4     0.248894     0.248852     0.249049
5       40       Triad:           8426.4     0.227914     0.227855     0.228082
6       40       Triad:           6785.9     0.283006     0.282940     0.283145
7       40       Triad:           7580.2     0.253347     0.253290     0.253483
------------------------------------------------------------------------------
0       44       Triad:           6189.5     0.310876     0.310205     0.311551
1       44       Triad:           7002.2     0.274298     0.274198     0.274366
2       44       Triad:           5626.4     0.341283     0.341246     0.341399
3       44       Triad:           6041.6     0.318231     0.317794     0.319748
4       44       Triad:           7717.2     0.248835     0.248796     0.248886
5       44       Triad:           8769.5     0.218987     0.218941     0.219042
6       44       Triad:           6786.4     0.282951     0.282919     0.283010
7       44       Triad:           7581.0     0.253296     0.253264     0.253357
------------------------------------------------------------------------------
0       48       Triad:           5022.0     0.382413     0.382315     0.382498
1       48       Triad:           5605.2     0.342579     0.342537     0.342715
2       48       Triad:           7084.8     0.271033     0.271003     0.271060
3       48       Triad:           5983.4     0.320929     0.320887     0.320980
4       48       Triad:           6036.1     0.318117     0.318085     0.318171
5       48       Triad:           6441.8     0.298082     0.298055     0.298115
6       48       Triad:           8973.8     0.213989     0.213956     0.214040
7       48       Triad:           7538.5     0.254727     0.254692     0.254803
------------------------------------------------------------------------------
0       52       Triad:           5047.0     0.381585     0.380426     0.382187
1       52       Triad:           5829.9     0.354521     0.329335     0.406152
2       52       Triad:           7030.3     0.273133     0.273102     0.273151
3       52       Triad:           5741.0     0.334480     0.334439     0.334549
4       52       Triad:           5805.3     0.330776     0.330733     0.330828
5       52       Triad:           6321.8     0.303755     0.303713     0.303790
6       52       Triad:           9360.5     0.205153     0.205117     0.205239
7       52       Triad:           7538.8     0.254722     0.254684     0.254793
------------------------------------------------------------------------------
0       56       Triad:           5743.2     0.344355     0.334311     0.345718
1       56       Triad:           6241.5     0.307768     0.307619     0.307853
2       56       Triad:           6166.5     0.315565     0.311361     0.332701
3       56       Triad:           6716.1     0.292017     0.285881     0.379259
4       56       Triad:           6518.5     0.294591     0.294548     0.294648
5       56       Triad:           6992.7     0.274599     0.274573     0.274676
6       56       Triad:           7715.0     0.248988     0.248867     0.250501
7       56       Triad:           8699.2     0.220758     0.220710     0.220800
------------------------------------------------------------------------------
0       60       Triad:           5569.4     0.345883     0.344739     0.346729
1       60       Triad:           6548.5     0.298524     0.293195     0.308796
2       60       Triad:           6114.9     0.314029     0.313989     0.314070
3       60       Triad:           6509.5     0.294987     0.294952     0.295071
4       60       Triad:           6787.4     0.282915     0.282876     0.282982
5       60       Triad:           7086.3     0.270994     0.270947     0.271070
6       60       Triad:           7715.4     0.248911     0.248852     0.249140
7       60       Triad:           9068.5     0.211755     0.211721     0.211807
------------------------------------------------------------------------------
```

## benchmark interlave 

benchmark_numa_interlave.sh
```bash
#!/bin/bash

echo "------------------------------------------------------------------------------"
echo "Node    Core    Function    Best Rate MB/s  Avg time     Min time     Max time"
for core in `seq 0 63`; do
        echo 3 > /proc/sys/vm/drop_caches
        if [ `expr $core % 4` == 0 ];then
                echo "------------------------------------------------------------------------------"
                echo -n "0-7       $core       "
                numactl  --interleave=0-7 taskset -c $core ./stream | egrep Triad
        fi
done
echo "------------------------------------------------------------------------------"
```
report:
```
[root@centos7 ~]# ./benchmark_numa_interlave.sh
------------------------------------------------------------------------------
Node    Core    Function    Best Rate MB/s  Avg time     Min time     Max time
------------------------------------------------------------------------------
0-7       0       Triad:           6822.7     0.286845     0.281415     0.318160
------------------------------------------------------------------------------
0-7       4       Triad:           6856.9     0.286915     0.280010     0.317930
------------------------------------------------------------------------------
0-7       8       Triad:           7319.9     0.263785     0.262300     0.270159
------------------------------------------------------------------------------
0-7       12       Triad:           7361.1     0.260901     0.260831     0.261056
------------------------------------------------------------------------------
0-7       16       Triad:           6819.9     0.281586     0.281529     0.281731
------------------------------------------------------------------------------
0-7       20       Triad:           6850.3     0.285860     0.280278     0.316564
------------------------------------------------------------------------------
0-7       24       Triad:           7339.9     0.275201     0.261583     0.342236
------------------------------------------------------------------------------
0-7       28       Triad:           7384.0     0.263065     0.260020     0.269725
------------------------------------------------------------------------------
0-7       32       Triad:           6800.6     0.282410     0.282326     0.282612
------------------------------------------------------------------------------
0-7       36       Triad:           6834.4     0.281007     0.280930     0.281141
------------------------------------------------------------------------------
0-7       40       Triad:           7328.6     0.262151     0.261987     0.262317
------------------------------------------------------------------------------
0-7       44       Triad:           7364.4     0.260745     0.260712     0.260809
------------------------------------------------------------------------------
0-7       48       Triad:           6814.3     0.281822     0.281760     0.281880
------------------------------------------------------------------------------
0-7       52       Triad:           6846.5     0.280505     0.280436     0.280925
------------------------------------------------------------------------------
0-7       56       Triad:           7341.0     0.273422     0.261544     0.303478
------------------------------------------------------------------------------
0-7       60       Triad:           7377.2     0.265707     0.260261     0.268816
------------------------------------------------------------------------------
```